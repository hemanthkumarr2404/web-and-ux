<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Neon Speed Type — Ultimate</title>
    <meta name="description" content="Neon Speed Type — improved typing test with accessibility, mobile support, sounds, high-scores, difficulty modes and more." />
    <style>
         :root {
            --bg-1: #0f0c29;
            --bg-2: #302b63;
            --bg-3: #24243e;
            --card-bg: rgba(20, 20, 20, 0.75);
            --glass: rgba(255, 255, 255, 0.04);
            --muted: #9aa3b2;
            --neon-green: #00e676;
            --neon-pink: #ff00ff;
            --neon-blue: #00ffff;
            --neon-yellow: #ffeb3b;
            --error-color: #ff5252;
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-code: 'Courier New', Courier, monospace;
            --radius: 12px;
        }
        
        * {
            box-sizing: border-box;
        }
        
        html,
        body {
            height: 100%;
        }
        
        body {
            margin: 0;
            font-family: var(--font-main);
            color: #fff;
            background: linear-gradient(135deg, var(--bg-1), var(--bg-2), var(--bg-3));
            background-size: 400% 400%;
            animation: bgAnim 18s ease infinite;
            -webkit-font-smoothing: antialiased;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 24px;
        }
        
        @keyframes bgAnim {
            0% {
                background-position: 0% 50%
            }
            50% {
                background-position: 100% 50%
            }
            100% {
                background-position: 0% 50%
            }
        }
        
        .app {
            width: 100%;
            max-width: 1100px;
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 20px;
            align-items: start;
        }
        
        header.app-header {
            grid-column: 1/-1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 6px;
        }
        
        .title {
            font-size: 1.5rem;
            font-weight: 800;
            letter-spacing: 1px;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .title span {
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent
        }
        
        .controls {
            display: flex;
            gap: 8px;
            align-items: center
        }
        
        button.icon-btn {
            background: transparent;
            border: 1px solid var(--glass);
            padding: 8px 12px;
            border-radius: 10px;
            color: var(--muted);
            cursor: pointer
        }
        
        button.icon-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.5)
        }
        /* LEFT: GAME AREA */
        
        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.04)
        }
        
        .game-area {
            min-height: 420px;
            display: flex;
            flex-direction: column;
            gap: 16px
        }
        
        .top-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center
        }
        
        .time-selector {
            display: flex;
            gap: 8px
        }
        
        .time-selector button {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06);
            padding: 8px 12px;
            border-radius: 8px;
            color: var(--neon-blue);
            cursor: pointer
        }
        
        .time-selector button.active {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 12px var(--neon-blue)
        }
        
        .mode-selector {
            display: flex;
            gap: 8px
        }
        
        .mode-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06);
            padding: 6px 8px;
            border-radius: 8px;
            color: var(--neon-pink);
            cursor: pointer
        }
        
        .mode-btn.active {
            background: var(--neon-pink);
            color: #000;
            box-shadow: 0 0 12px var(--neon-pink)
        }
        
        .stats {
            display: flex;
            gap: 12px;
            align-items: center
        }
        
        .stat {
            background: var(--glass);
            padding: 10px 14px;
            border-radius: 10px;
            text-align: center;
            min-width: 80px
        }
        
        .stat .value {
            font-size: 1.4rem;
            font-weight: 700
        }
        
        .stat .label {
            font-size: 0.75rem;
            color: var(--muted);
            text-transform: uppercase;
            margin-top: 4px
        }
        
        .typing-area {
            position: relative;
            padding: 18px;
            border-radius: 10px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(0, 0, 0, 0.12));
            min-height: 150px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            overflow: auto
        }
        
        #quote-display {
            font-family: var(--font-code);
            font-size: 1.1rem;
            color: #cbd5e1;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word
        }
        
        .char.correct {
            color: var(--neon-green);
            text-shadow: 0 0 6px var(--neon-green)
        }
        
        .char.incorrect {
            color: var(--error-color);
            text-decoration: underline;
            text-shadow: 0 0 6px var(--error-color)
        }
        
        .char.cursor {
            border-left: 2px solid var(--neon-pink);
            padding-right: 2px;
            animation: blink 1s step-end infinite
        }
        
        .cursor-end {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background: var(--neon-pink);
            margin-left: 2px;
            vertical-align: middle;
            animation: blink 1s step-end infinite
        }
        
        @keyframes blink {
            50% {
                opacity: 0
            }
        }
        
        textarea#quote-input {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            border: none;
            resize: none;
            font-size: 1rem
        }
        
        .bottom-row {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap
        }
        
        .btn {
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue));
            border: none;
            padding: 12px 20px;
            border-radius: 999px;
            color: #000;
            font-weight: 700;
            cursor: pointer
        }
        
        .ghost {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06);
            color: var(--muted)
        }
        /* RIGHT: SIDEBAR */
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 12px
        }
        
        .history-list {
            max-height: 260px;
            overflow: auto
        }
        
        table {
            width: 100%;
            border-collapse: collapse
        }
        
        td,
        th {
            padding: 6px 8px;
            text-align: left;
            font-size: 0.9rem
        }
        
        th {
            color: var(--neon-yellow);
            font-size: 0.75rem;
            text-transform: uppercase
        }
        
        tr:nth-child(even) td {
            background: transparent
        }
        
        .progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.04);
            border-radius: 999px;
            overflow: hidden
        }
        
        .progress>i {
            display: block;
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-green));
            transition: width 300ms ease
        }
        
        .footer-note {
            font-size: 0.8rem;
            color: var(--muted)
        }
        /* responsive */
        
        @media (max-width:980px) {
            .app {
                grid-template-columns: 1fr;
            }
            .sidebar {
                order: 2
            }
        }
        
        @media (max-width:560px) {
            .title {
                font-size: 1.125rem
            }
            .stat {
                min-width: 64px
            }
            .typing-area {
                min-height: 120px
            }
        }
        /* Accessibility focus rings */
        
        button:focus,
        [tabindex]:focus {
            outline: 3px solid rgba(255, 255, 255, 0.06);
            outline-offset: 2px
        }
    </style>
</head>

<body>
    <div class="app" role="application" aria-label="Neon Speed Type — improved typing test">
        <header class="app-header">
            <div class="title"><strong>Neon</strong><span>Type</span></div>
            <div class="controls">
                <button class="icon-btn" id="theme-toggle" title="Toggle contrast/theme">Toggle Theme</button>
                <button class="icon-btn" id="sound-toggle" aria-pressed="false" title="Toggle sound effects">Sound</button>
                <button class="icon-btn" id="help-btn" title="Shortcuts & help">Help</button>
            </div>
        </header>

        <!-- LEFT: Game -->
        <section class="card game-area" aria-labelledby="game-title">
            <div class="top-row">
                <div style="flex:1">
                    <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
                        <div class="time-selector" role="radiogroup" aria-label="Select duration">
                            <button class="time-btn" data-time="30">30s</button>
                            <button class="time-btn active" data-time="60">60s</button>
                            <button class="time-btn" data-time="120">120s</button>
                        </div>

                        <div class="mode-selector" role="radiogroup" aria-label="Difficulty mode">
                            <button class="mode-btn active" data-mode="normal">Normal</button>
                            <button class="mode-btn" data-mode="easy">Easy</button>
                            <button class="mode-btn" data-mode="hard">Hard</button>
                        </div>

                        <div class="progress" aria-hidden="true" style="width:160px"><i id="time-bar"></i></div>
                    </div>
                </div>

                <div class="stats" aria-hidden="false">
                    <div class="stat" aria-label="seconds left">
                        <div class="value" id="timer">60</div>
                        <div class="label">Seconds</div>
                    </div>
                    <div class="stat" aria-label="words per minute">
                        <div class="value" id="wpm">0</div>
                        <div class="label">WPM</div>
                    </div>
                    <div class="stat" aria-label="accuracy">
                        <div class="value" id="accuracy">100%</div>
                        <div class="label">Accuracy</div>
                    </div>
                </div>
            </div>

            <div class="typing-area" role="region" aria-label="Typing area" tabindex="0" id="typing-area">
                <div id="quote-display" aria-live="polite">Click 'Start' or press <strong>Space</strong> to begin.</div>
                <textarea id="quote-input" aria-label="Typing input" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
            </div>

            <div class="bottom-row">
                <button class="btn" id="start-btn">Start / Restart</button>
                <button class="ghost" id="pause-btn" aria-pressed="false">Pause</button>
                <button class="ghost" id="skip-btn">Skip Quote</button>

                <div style="margin-left:auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
                    <button class="ghost" id="share-btn">Share Result</button>
                    <button class="ghost" id="download-btn">Download Result</button>
                </div>
            </div>
        </section>

        <!-- RIGHT: Sidebar -->
        <aside class="sidebar">
            <div class="card">
                <h3 style="margin:0 0 8px 0">Quick Settings</h3>
                <div style="display:flex;flex-direction:column;gap:8px">
                    <label style="font-size:0.9rem;color:var(--muted)">Content
                        <select id="content-type" style="width:100%;padding:8px;margin-top:6px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04)">
                            <option value="random">Random Quotes</option>
                            <option value="custom">Custom Text</option>
                        </select>
                    </label>
                    <textarea id="custom-content-area" placeholder="Paste custom text for custom mode" rows="4" style="width:100%;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);font-family:var(--font-code);display:none"></textarea>

                    <label style="font-size:0.9rem;color:var(--muted)">Max History
                        <input id="history-limit" type="number" min="1" max="50" value="20" style="width:100%;padding:8px;margin-top:6px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04)" />
                    </label>
                </div>
            </div>

            <div class="card">
                <h3 style="margin:0 0 8px 0">History</h3>
                <div class="history-list" id="history-list" aria-live="polite"></div>
                <div style="display:flex;gap:8px;margin-top:8px">
                    <button id="clear-history-btn" class="ghost">Clear</button>
                    <button id="export-history-btn" class="ghost">Export</button>
                </div>
            </div>

            <div class="card footer-note">Shortcuts: Space → Start/Restart, Esc → Pause/Resume, Ctrl+S → Share result, Ctrl+D → Download result</div>
        </aside>
    </div>

    <script>
        // ---- DATA / QUOTES ----
        const quotes = [
            "The quick brown fox jumps over the lazy dog.",
            "Technology is best when it brings people together.",
            "It does not matter how slowly you go as long as you do not stop.",
            "Success is not final, failure is not fatal: it is the courage to continue that counts.",
            "In the middle of difficulty lies opportunity.",
            "Code is like humor. When you have to explain it, it’s bad.",
            "Simplicity is the soul of efficiency.",
            "To be or not to be, that is the question.",
            "Real programmers count from zero.",
            "Knowledge is power.",
            // add more filler quotes to make chaining feel better
            "Learning never exhausts the mind.",
            "Perseverance is not a long race; it is many short races one after another.",
            "Make it work, make it right, make it fast."
        ];

        // ---- ELEMENTS ----
        const quoteDisplay = document.getElementById('quote-display');
        const quoteInput = document.getElementById('quote-input');
        const timerEl = document.getElementById('timer');
        const wpmEl = document.getElementById('wpm');
        const accEl = document.getElementById('accuracy');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const skipBtn = document.getElementById('skip-btn');
        const timeBtns = document.querySelectorAll('.time-btn');
        const modeBtns = document.querySelectorAll('.mode-btn');
        const timeBar = document.getElementById('time-bar');
        const contentSelect = document.getElementById('content-type');
        const customArea = document.getElementById('custom-content-area');
        const contentAreaRegion = document.getElementById('typing-area');
        const historyList = document.getElementById('history-list');
        const themeToggle = document.getElementById('theme-toggle');
        const soundToggle = document.getElementById('sound-toggle');
        const helpBtn = document.getElementById('help-btn');
        const shareBtn = document.getElementById('share-btn');
        const downloadBtn = document.getElementById('download-btn');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        const exportHistoryBtn = document.getElementById('export-history-btn');
        const historyLimitInput = document.getElementById('history-limit');

        // ---- STATE ----
        let maxTime = 60;
        let timer = 60;
        let timerInterval = null;
        let isPlaying = false;
        let isPaused = false;
        let totalCorrect = 0;
        let totalTyped = 0;
        let totalErrors = 0;
        let charIndex = 0;
        let currentQuote = '';
        let contentType = 'random';
        let mode = 'normal';
        let historyLimit = parseInt(historyLimitInput.value || 20, 10);
        let soundOn = true;

        // ---- SOUNDS (small beep/wrong) ----
        const audioCtx = new(window.AudioContext || window.webkitAudioContext)();

        function beep(freq = 880, duration = 0.06, type = 'sine') {
            if (!soundOn) return;
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.type = type;
            o.frequency.value = freq;
            g.gain.value = 0.05;
            o.connect(g);
            g.connect(audioCtx.destination);
            o.start();
            g.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
            setTimeout(() => o.stop(), duration * 1000 + 20);
        }

        // ---- UTILITIES ----
        function randQuote() {
            return quotes[Math.floor(Math.random() * quotes.length)];
        }

        function clamp(v, min, max) {
            return Math.max(min, Math.min(max, v))
        }

        // ---- RENDER QUOTE ----
        function renderQuote() {
            quoteDisplay.innerHTML = '';
            if (!currentQuote) return;
            const typed = quoteInput.value || '';
            for (let i = 0; i < currentQuote.length; i++) {
                const ch = document.createElement('span');
                ch.className = 'char';
                ch.textContent = currentQuote[i];
                if (i < typed.length) {
                    if (typed[i] === currentQuote[i]) ch.classList.add('correct');
                    else ch.classList.add('incorrect');
                }
                if (i === typed.length && isPlaying && !isPaused) ch.classList.add('cursor');
                quoteDisplay.appendChild(ch);
            }
            if (isPlaying && charIndex >= currentQuote.length) {
                const end = document.createElement('span');
                end.className = 'cursor-end';
                quoteDisplay.appendChild(end);
            }
        }

        // ---- STATS ----
        function updateStats() {
            const typed = quoteInput.value || '';
            // total correct chars
            let correct = 0;
            let errors = 0;
            for (let i = 0; i < typed.length; i++) {
                if (currentQuote[i] && typed[i] === currentQuote[i]) correct++;
                else errors++;
            }
            totalCorrect = correct;
            totalTyped = typed.length;
            totalErrors = errors;

            const elapsed = (maxTime - timer) / 60; // minutes
            const wpm = elapsed > 0 ? Math.round((totalCorrect / 5) / elapsed) : 0;
            wpmEl.textContent = (timer === maxTime) ? 0 : Math.max(0, wpm);
            const acc = totalTyped > 0 ? Math.round((totalCorrect / totalTyped) * 100) : 100;
            accEl.textContent = acc + '%';
        }

        // ---- TIMER / GAME FLOW ----
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (!isPlaying || isPaused) return;
                timer--;
                timerEl.textContent = timer;
                timeBar.style.width = `${Math.round(((maxTime - timer)/maxTime)*100)}%`;
                updateStats();
                if (timer <= 0) endGame();
            }, 1000);
        }

        function startGame(resetTime = true) {
            if (resetTime) {
                timer = maxTime;
                timerEl.textContent = timer;
                timeBar.style.width = '0%';
            }
            isPlaying = true;
            isPaused = false;
            totalCorrect = 0;
            totalTyped = 0;
            totalErrors = 0;
            charIndex = 0;
            quoteInput.value = '';
            if (contentType === 'custom' && customArea.value.trim()) {
                currentQuote = customArea.value.trim();
            } else currentQuote = randQuoteBasedOnMode();
            renderQuote();
            quoteInput.focus();
            startTimer();
        }

        function pauseGame() {
            if (!isPlaying) return;
            isPaused = !isPaused;
            pauseBtn.textContent = isPaused ? 'Resume' : 'Pause';
            pauseBtn.setAttribute('aria-pressed', String(isPaused));
            if (soundOn) beep(220, 0.08, 'sine');
        }

        function skipQuote() {
            if (contentType === 'custom') return; // don't skip custom
            currentQuote = randQuoteBasedOnMode();
            quoteInput.value = '';
            charIndex = 0;
            totalCorrect = 0;
            totalTyped = 0;
            totalErrors = 0;
            renderQuote();
            if (soundOn) beep(660, 0.06, 'sine');
        }

        function endGame() {
            clearInterval(timerInterval);
            isPlaying = false;
            isPaused = false;
            const finalWPM = parseInt(wpmEl.textContent, 10) || 0;
            const finalACC = accEl.textContent || '0%';
            saveToHistory(finalWPM, finalACC, maxTime);
            showResultToast(finalWPM, finalACC);
            if (soundOn) beep(440, 0.12, 'triangle');
        }

        // ---- MODE AFFECTING QUOTE LENGTH DIFFICULTY ----
        function randQuoteBasedOnMode() {
            if (mode === 'easy') {
                // pick shorter quotes
                return quotes.filter(q => q.length <= 60)[Math.floor(Math.random() * quotes.filter(q => q.length <= 60).length)];
            } else if (mode === 'hard') {
                // longer or combined quotes
                const c = quotes[Math.floor(Math.random() * quotes.length)];
                const c2 = quotes[Math.floor(Math.random() * quotes.length)];
                return (c + ' ' + c2).slice(0, 280);
            }
            return randQuote();
        }

        // ---- HISTORY STORAGE ----
        function saveToHistory(wpm, acc, duration) {
            const limit = parseInt(historyLimitInput.value || 20, 10);
            const history = JSON.parse(localStorage.getItem('neonTypeHistory') || '[]');
            history.unshift({
                wpm,
                acc,
                duration,
                date: new Date().toLocaleString()
            });
            while (history.length > limit) history.pop();
            localStorage.setItem('neonTypeHistory', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            const history = JSON.parse(localStorage.getItem('neonTypeHistory') || '[]');
            historyList.innerHTML = '';
            if (history.length === 0) {
                historyList.innerHTML = '<div style="color:#777">No records yet</div>';
                return;
            }
            history.forEach(h => {
                const div = document.createElement('div');
                div.style.display = 'flex';
                div.style.justifyContent = 'space-between';
                div.style.padding = '6px 0';
                div.innerHTML = `<div><strong>${h.wpm} WPM</strong> <span style='color:var(--muted);font-size:0.9rem'>${h.acc}</span></div><div style='color:var(--muted);font-size:0.85rem'>${h.date}</div>`;
                historyList.appendChild(div);
            });
        }

        function clearHistory() {
            localStorage.removeItem('neonTypeHistory');
            renderHistory();
        }

        function exportHistory() {
            const data = localStorage.getItem('neonTypeHistory') || '[]';
            const blob = new Blob([data], {
                type: 'application/json'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'neon-history.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // ---- RESULT / UX ----
        function showResultToast(wpm, acc) {
            // small ephemeral UI (use alert fallback)
            try {
                navigator.vibrate && navigator.vibrate(100);
            } catch (e) {}
            alert(`Time's up! WPM: ${wpm} — Accuracy: ${acc}`);
        }

        // ---- SHARE / DOWNLOAD ----
        async function shareResult() {
            const wpm = wpmEl.textContent;
            const acc = accEl.textContent;
            const text = `Neon Type — WPM: ${wpm}, Accuracy: ${acc}, Duration: ${maxTime}s`;
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Neon Type Result',
                        text
                    });
                    return;
                } catch (e) {}
            }
            // fallback: copy
            await navigator.clipboard.writeText(text);
            alert('Result copied to clipboard');
        }

        function downloadResult() {
            const wpm = wpmEl.textContent;
            const acc = accEl.textContent;
            const text = `Neon Type Result\nWPM: ${wpm}\nAccuracy: ${acc}\nDuration: ${maxTime}s\nDate: ${new Date().toLocaleString()}`;
            const blob = new Blob([text], {
                type: 'text/plain'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'neon-result.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        // ---- INPUT HANDLER ----
        quoteInput.addEventListener('input', (e) => {
            if (!isPlaying && quoteInput.value.length > 0) {
                startGame(false);
            }
            if (!isPlaying) return;
            charIndex = quoteInput.value.length;
            // if last typed wrong and sound enabled, beep
            const typed = quoteInput.value;
            const idx = typed.length - 1;
            if (idx >= 0 && currentQuote[idx] && typed[idx] !== currentQuote[idx]) {
                if (soundOn) beep(120, 0.05, 'sawtooth');
            }

            updateStats();
            renderQuote();
            // if quote completed
            if (charIndex >= currentQuote.length) {
                if (contentType === 'random') { // chain next quote without resetting time
                    currentQuote = randQuoteBasedOnMode();
                    quoteInput.value = '';
                    charIndex = 0;
                    renderQuote();
                } else {
                    endGame();
                }
            }
        });

        // ---- BUTTONS ----
        startBtn.addEventListener('click', () => startGame(true));
        pauseBtn.addEventListener('click', pauseGame);
        skipBtn.addEventListener('click', skipQuote);

        timeBtns.forEach(b => b.addEventListener('click', (e) => {
            timeBtns.forEach(x => x.classList.remove('active'));
            e.currentTarget.classList.add('active');
            maxTime = parseInt(e.currentTarget.dataset.time, 10);
            timer = maxTime;
            timerEl.textContent = timer;
            startGame(true);
        }));

        modeBtns.forEach(b => b.addEventListener('click', (e) => {
            modeBtns.forEach(x => x.classList.remove('active'));
            e.currentTarget.classList.add('active');
            mode = e.currentTarget.dataset.mode;
            startGame(true);
        }));

        contentSelect.addEventListener('change', (e) => {
            contentType = e.target.value;
            customArea.style.display = contentType === 'custom' ? 'block' : 'none';
            startGame(true);
        });

        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('high-contrast');
        });
        soundToggle.addEventListener('click', () => {
            soundOn = !soundOn;
            soundToggle.setAttribute('aria-pressed', String(!soundOn));
        });
        helpBtn.addEventListener('click', () => {
            alert('Shortcuts:\nSpace — Start/Restart\nEsc — Pause/Resume\nCtrl/Cmd+S — Share\nCtrl/Cmd+D — Download');
        });

        shareBtn.addEventListener('click', shareResult);
        downloadBtn.addEventListener('click', downloadResult);
        clearHistoryBtn.addEventListener('click', () => {
            if (confirm('Clear history?')) clearHistory();
        });
        exportHistoryBtn.addEventListener('click', exportHistory);
        historyLimitInput.addEventListener('change', () => {
            renderHistory();
        });

        // ---- KEYBOARD SHORTCUTS ----
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && e.target === document.body) {
                e.preventDefault();
                startGame(true);
            }
            if (e.key === 'Escape') {
                pauseGame();
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
                e.preventDefault();
                shareResult();
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'd') {
                e.preventDefault();
                downloadResult();
            }
        });

        // ---- ON LOAD ----
        document.addEventListener('DOMContentLoaded', () => {
            // load settings
            const stored = JSON.parse(localStorage.getItem('neonTypeSettings') || '{}');
            if (stored.maxTime) maxTime = stored.maxTime;
            if (stored.mode) mode = stored.mode;
            if (stored.soundOn !== undefined) soundOn = stored.soundOn;
            historyLimit = parseInt(historyLimitInput.value || 20, 10);
            timer = maxTime;
            timerEl.textContent = timer;

            // initial quote
            currentQuote = randQuoteBasedOnMode();
            renderQuote();
            renderHistory();

            // small accessibility focus
            contentAreaRegion.addEventListener('click', () => quoteInput.focus());
        });

        // Save small settings on unload
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('neonTypeSettings', JSON.stringify({
                maxTime,
                mode,
                soundOn
            }));
        });
    </script>
</body>

</html>